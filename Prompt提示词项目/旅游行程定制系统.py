import streamlit as st
import matplotlib.pyplot as plt
import seaborn as sns
from openai import OpenAI
from dotenv import load_dotenv
import os

load_dotenv()
client = OpenAI(api_key=os.getenv("DASHSCOPE_API_KEY"), base_url=os.getenv("DASHSCOPE_BASE_URL"))

# è®¾ç½®é¡µé¢é…ç½®
st.set_page_config(
    page_title="æ—…è¡Œè§„åˆ’åŠ©æ‰‹",
    page_icon="ğŸŒ",
    layout="wide"
)

# è®¾ç½®ä¸­æ–‡å­—ä½“
plt.rcParams["font.family"] = ["SimHei", "WenQuanYi Micro Hei", "Heiti TC"]
plt.rcParams["axes.unicode_minus"] = False  # è§£å†³è´Ÿå·æ˜¾ç¤ºé—®é¢˜

# ç®€åŒ–çš„ç›®çš„åœ°æ•°æ®
destinations = {
    "äºšæ´²": ["æ—¥æœ¬", "æ³°å›½", "ä¸­å›½", "éŸ©å›½", "é©¬æ¥è¥¿äºš"],
    "æ¬§æ´²": ["æ³•å›½", "æ„å¤§åˆ©", "è¥¿ç­ç‰™", "è‹±å›½", "å¾·å›½"],
    "åŒ—ç¾æ´²": ["ç¾å›½", "åŠ æ‹¿å¤§", "å¢¨è¥¿å“¥"],
    "å—ç¾æ´²": ["å·´è¥¿", "é˜¿æ ¹å»·", "ç§˜é²"],
    "å¤§æ´‹æ´²": ["æ¾³å¤§åˆ©äºš", "æ–°è¥¿å…°"],
    "éæ´²": ["å—é", "åŸƒåŠ", "æ‘©æ´›å“¥"]
}

# ç›®çš„åœ°è¯¦ç»†ä¿¡æ¯   å­—å…¸=é”®å€¼å¯¹
destination_details = {
    "æ—¥æœ¬": {
        "ç‰¹è‰²": "æ–‡åŒ–èåˆã€ç¾é£Ÿã€æ¨±èŠ±/çº¢å¶å­£ã€è´­ç‰©",
        "æœ€ä½³å­£èŠ‚": "æ˜¥å­£(3-4æœˆ,æ¨±èŠ±)ã€ç§‹å­£(10-11æœˆ,çº¢å¶)",
        "ç»å…¸æ™¯ç‚¹": ["ä¸œäº¬è¿ªå£«å°¼", "å¯Œå£«å±±", "äº¬éƒ½é‡‘é˜å¯º", "å¤§é˜ªåŸå…¬å›­"],
        "ç¾é£Ÿ": ["å¯¿å¸", "æ‹‰é¢", "å¤©å¦‡ç½—", "æ€€çŸ³æ–™ç†"],
        "æ–‡åŒ–æ³¨æ„": ["è¿›å…¥å®¤å†…è„±é‹", "å…¬å…±åœºåˆä¿æŒå®‰é™", "åƒåœ¾åˆ†ç±»ä¸¥æ ¼"]
    },
    "æ³°å›½": {
        "ç‰¹è‰²": "æµ·æ»©ã€å¯ºåº™ã€ç¾é£Ÿã€çƒ­å¸¦æ°”å€™",
        "æœ€ä½³å­£èŠ‚": "11æœˆ-æ¬¡å¹´4æœˆ(æ—±å­£)",
        "ç»å…¸æ™¯ç‚¹": ["æ›¼è°·å¤§çš‡å®«", "æ™®å‰å²›", "æ¸…è¿ˆå¤åŸ", "çš®çš®å²›"],
        "ç¾é£Ÿ": ["å†¬é˜´åŠŸæ±¤", "æ³°å¼ç‚’æ²³ç²‰", "èŠ’æœç³¯ç±³é¥­", "ç»¿å’–å–±é¸¡"],
        "æ–‡åŒ–æ³¨æ„": ["å°Šé‡ç‹å®¤å’Œåƒ§ä¾£", "å¤´éƒ¨ä¸ºç¥åœ£éƒ¨ä½", "å…¬å…±åœºåˆé¿å…äº²æ˜µè¡Œä¸º"]
    },
    "æ³•å›½": {
        "ç‰¹è‰²": "æµªæ¼«ã€è‰ºæœ¯ã€ç¾é£Ÿã€æ—¶å°š",
        "æœ€ä½³å­£èŠ‚": "5-6æœˆ(æ˜¥å­£)ã€9-10æœˆ(ç§‹å­£)",
        "ç»å…¸æ™¯ç‚¹": ["åŸƒè²å°”é“å¡”", "å¢æµ®å®«", "æ™®ç½—æ—ºæ–¯", "å‡¡å°”èµ›å®«"],
        "ç¾é£Ÿ": ["æ³•å¼é¢åŒ…", "å¥¶é…ª", "è‘¡è„é…’", "é¹…è‚é…±"],
        "æ–‡åŒ–æ³¨æ„": ["è§é¢äº²å»ç¤¼", "é¤å…é¢„çº¦", "å°Šé‡è‰ºæœ¯ä½œå“"]
    },
    "æ„å¤§åˆ©": {
        "ç‰¹è‰²": "å†å²ã€ç¾é£Ÿã€è‰ºæœ¯ã€æ—¶å°š",
        "æœ€ä½³å­£èŠ‚": "4-5æœˆ(æ˜¥å­£)ã€9-10æœˆ(ç§‹å­£)",
        "ç»å…¸æ™¯ç‚¹": ["ç½—é©¬æ–—å…½åœº", "å¨å°¼æ–¯", "ä½›ç½—ä¼¦è¨", "ç±³å…°å¤§æ•™å ‚"],
        "ç¾é£Ÿ": ["æŠ«è¨", "æ„å¤§åˆ©é¢", "å†°æ·‡æ·‹", "ææ‹‰ç±³è‹"],
        "æ–‡åŒ–æ³¨æ„": ["ç€è£…ç¤¼ä»ª", "ç”¨é¤æ—¶é—´è¾ƒé•¿", "æ•™å ‚ç€è£…è¦æ±‚"]
    },
    "ç¾å›½": {
        "ç‰¹è‰²": "å¤šå…ƒæ–‡åŒ–ã€è‡ªç„¶å¥‡è§‚ã€ä¸»é¢˜å…¬å›­",
        "æœ€ä½³å­£èŠ‚": "å› åœ°åŒºè€Œå¼‚(è¥¿éƒ¨5-10æœˆ,ä¸œéƒ¨5-9æœˆ)",
        "ç»å…¸æ™¯ç‚¹": ["å¤§å³¡è°·", "çº½çº¦æ—¶ä»£å¹¿åœº", "è¿ªå£«å°¼ä¹å›­", "é»„çŸ³å›½å®¶å…¬å›­"],
        "ç¾é£Ÿ": ["æ±‰å ¡", "æŠ«è¨", "BBQ", "ç”œç”œåœˆ"],
        "æ–‡åŒ–æ³¨æ„": ["å°è´¹æ–‡åŒ–", "ä¸ªäººç©ºé—´", "å°Šé‡å¤šå…ƒæ–‡åŒ–"]
    }
}

# æ—…è¡Œä¸»é¢˜
travel_themes = {
    "ä¼‘é—²åº¦å‡": ["æ”¾æ¾", "SPA", "æµ·æ»©", "æ™’å¤ªé˜³"],
    "ç¾é£Ÿæ¢ç´¢": ["ç¾é£Ÿ", "å°åƒ", "é¤å…", "çƒ¹é¥ªè¯¾ç¨‹"],
    "æ–‡åŒ–ä½“éªŒ": ["æ–‡åŒ–", "è‰ºæœ¯", "åšç‰©é¦†", "ä¼ ç»Ÿ"],
    "æˆ·å¤–æ¢é™©": ["å¾’æ­¥", "ç™»å±±", "éª‘è¡Œ", "æ¢é™©"],
    "è´­ç‰©è¡€æ‹¼": ["è´­ç‰©", "å•†åœº", "å¸‚é›†", "å¥¢ä¾ˆå“"],
    "äº²å­æ¸¸ç©": ["åŠ¨ç‰©å›­", "æ¸¸ä¹å›­", "äº’åŠ¨ä½“éªŒ", "æ•™è‚²"],
    "æµªæ¼«èœœæœˆ": ["æµªæ¼«", "æµ·æ™¯", "ç§å¯†", "çƒ›å…‰æ™šé¤"],
    "å†å²è€ƒå¤": ["å†å²", "å¤è¿¹", "é—å€", "è€ƒå¤"]
}

# é¢„ç®—æ°´å¹³
budget_levels = {
    "ç»æµå‹": {"æ¯æ—¥é¢„ç®—": "300-800å…ƒ", "ä½å®¿": "é’å¹´æ—…ç¤¾/ç»æµå‹é…’åº—"},
    "ä¸­ç­‰ä»·ä½": {"æ¯æ—¥é¢„ç®—": "800-1500å…ƒ", "ä½å®¿": "ä¸‰æ˜Ÿçº§é…’åº—/ç²¾å“é…’åº—"},
    "é«˜ç«¯å¥¢å": {"æ¯æ—¥é¢„ç®—": "1500å…ƒä»¥ä¸Š", "ä½å®¿": "äº”æ˜Ÿçº§é…’åº—/åº¦å‡æ‘"}
}

# å®‰å…¨æç¤º
safety_tips = {
    "é€šç”¨": [
        "æå‰äº†è§£ç›®çš„åœ°çš„å®‰å…¨çŠ¶å†µå’Œå½“åœ°æ³•å¾‹æ³•è§„",
        "è´­ä¹°æ¶µç›–åŒ»ç–—å’Œç´§æ€¥æ•‘æ´çš„æ—…è¡Œä¿é™©",
        "ä¿ç®¡å¥½ä¸ªäººè´¢ç‰©ï¼Œå°¤å…¶æ˜¯åœ¨äººå¤šæ‹¥æŒ¤çš„åœ°æ–¹",
        "éšèº«æºå¸¦ç´§æ€¥è”ç³»æ–¹å¼"
    ],
    "æ–‡åŒ–": {
        "æ—¥æœ¬": ["è¿›å…¥å®¤å†…è„±é‹", "å…¬å…±åœºåˆä¿æŒå®‰é™", "åƒåœ¾åˆ†ç±»ä¸¥æ ¼"],
        "æ³°å›½": ["å°Šé‡ç‹å®¤å’Œåƒ§ä¾£", "å¤´éƒ¨ä¸ºç¥åœ£éƒ¨ä½", "å…¬å…±åœºåˆé¿å…äº²æ˜µè¡Œä¸º"],
        "æ³•å›½": ["è§é¢äº²å»ç¤¼", "é¤å…é¢„çº¦", "å°Šé‡è‰ºæœ¯ä½œå“"],
        "æ„å¤§åˆ©": ["ç€è£…ç¤¼ä»ª", "ç”¨é¤æ—¶é—´è¾ƒé•¿", "æ•™å ‚ç€è£…è¦æ±‚"],
        "ç¾å›½": ["å°è´¹æ–‡åŒ–", "ä¸ªäººç©ºé—´", "å°Šé‡å¤šå…ƒæ–‡åŒ–"]
    }
}

# è¡Œææ¸…å•
packing_lists = {
    "æ˜¥å­£": ["è½»ä¾¿å¤–å¥—", "é•¿è¢–è¡¬è¡«", "èˆ’é€‚é‹å­", "é›¨ä¼"],
    "å¤å­£": ["çŸ­è¢–è¡£ç‰©", "çŸ­è£¤", "å‡‰é‹", "é˜²æ™’éœœ", "å¤ªé˜³é•œ", "å¸½å­"],
    "ç§‹å­£": ["è–„å¤–å¥—", "æ¯›è¡£", "ç‰›ä»”è£¤", "èˆ’é€‚é‹å­"],
    "å†¬å­£": ["åšå¤–å¥—", "ç¾½ç»’æœ", "å›´å·¾", "æ‰‹å¥—", "ä¿æš–å†…è¡£", "é›ªåœ°é´"],
    "é€šç”¨": ["æŠ¤ç…§å’Œç­¾è¯æ–‡ä»¶", "æœºç¥¨å’Œé…’åº—é¢„è®¢ç¡®è®¤å•", "æ‰‹æœºå……ç”µå™¨", "ç°é‡‘å’Œä¿¡ç”¨å¡"]
}


# ç”Ÿæˆæç¤ºè¯
def generate_prompt(destination, theme, days, season, budget, special_requests):
    """ç”Ÿæˆå‘é€ç»™å¤§æ¨¡å‹çš„æç¤ºè¯"""
    dest_info = destination_details.get(destination, {})
    theme_keywords = travel_themes.get(theme, [])

    # å­£èŠ‚è½¬æ¢
    season_mapping = {
        "æ˜¥å­£ï¼ˆ3-5æœˆï¼‰": "æ˜¥å­£",
        "å¤å­£ï¼ˆ6-8æœˆï¼‰": "å¤å­£",
        "ç§‹å­£ï¼ˆ9-11æœˆï¼‰": "ç§‹å­£",
        "å†¬å­£ï¼ˆ12-2æœˆï¼‰": "å†¬å­£"
    }
    season_short = season_mapping.get(season, "æ˜¥å­£")

    # æ„å»ºæç¤ºè¯-åŠ¨æ€
    prompt = f"""
        ä½ æ˜¯ä¸€ä½ä¸“ä¸šçš„æ—…è¡Œé¡¾é—®ï¼Œæ“…é•¿æ ¹æ®ç”¨æˆ·éœ€æ±‚ç”Ÿæˆè¯¦ç»†çš„æ—…è¡Œè®¡åˆ’ã€‚è¯·æ ¹æ®ä»¥ä¸‹ä¿¡æ¯ä¸ºç”¨æˆ·ç”Ÿæˆä¸€ä»½åˆ°{destination}çš„{days}æ—¥{theme}æ—…è¡Œè®¡åˆ’ï¼š
        
        ### ç”¨æˆ·åŸºæœ¬ä¿¡æ¯
        - ç›®çš„åœ°ï¼š{destination}
        - æ—…è¡Œå¤©æ•°ï¼š{days}å¤©
        - æ—…è¡Œå­£èŠ‚ï¼š{season_short}
        - é¢„ç®—æ°´å¹³ï¼š{budget}ï¼ˆæ¯æ—¥é¢„ç®—{budget_levels[budget]['æ¯æ—¥é¢„ç®—']}ï¼‰
        - ç‰¹æ®Šè¦æ±‚ï¼š{special_requests if special_requests else "æ— ç‰¹æ®Šè¦æ±‚"}
        
        ### ç›®çš„åœ°ç›¸å…³ä¿¡æ¯
        - ç‰¹è‰²ï¼š{dest_info.get('ç‰¹è‰²', 'ä¸°å¯Œçš„æ–‡åŒ–å’Œè‡ªç„¶æ™¯è§‚')}
        - æœ€ä½³å­£èŠ‚ï¼š{dest_info.get('æœ€ä½³å­£èŠ‚', 'å…¨å¹´é€‚å®œ')}
        - ç»å…¸æ™¯ç‚¹ï¼š{', '.join(dest_info.get('ç»å…¸æ™¯ç‚¹', ['å½“åœ°è‘—åæ™¯ç‚¹']))}
        - ç¾é£Ÿæ¨èï¼š{', '.join(dest_info.get('ç¾é£Ÿ', ['å½“åœ°ç¾é£Ÿ']))}
        - æ–‡åŒ–æ³¨æ„äº‹é¡¹ï¼š{', '.join(dest_info.get('æ–‡åŒ–æ³¨æ„', ['å°Šé‡å½“åœ°ä¹ ä¿—']))}
        
        ### æ—…è¡Œä¸»é¢˜ç›¸å…³ä¿¡æ¯
        ç”¨æˆ·é€‰æ‹©çš„æ—…è¡Œä¸»é¢˜æ˜¯"{theme}"ï¼Œç›¸å…³å…³é”®è¯åŒ…æ‹¬ï¼š{', '.join(theme_keywords)}
        
        ### è¾“å‡ºè¦æ±‚
        è¯·ç”Ÿæˆä¸€ä»½è¯¦ç»†çš„æ—…è¡Œè®¡åˆ’ï¼ŒåŒ…æ‹¬ï¼š
        1. æ¯æ—¥è¡Œç¨‹å®‰æ’ï¼ˆæŒ‰ä¸Šåˆã€ä¸‹åˆã€æ™šä¸Šåˆ†æ®µï¼ŒåŒ…æ‹¬æ´»åŠ¨ã€äº¤é€šã€é¤é¥®å»ºè®®ï¼‰
        2. ä½å®¿æ¨èï¼ˆç¬¦åˆç”¨æˆ·é¢„ç®—æ°´å¹³ï¼‰
        3. é¢„ç®—ä¼°ç®—ï¼ˆåŒ…æ‹¬äº¤é€šã€ä½å®¿ã€é¤é¥®ã€é—¨ç¥¨ç­‰åˆ†é¡¹ï¼Œæ€»é¢„ç®—ï¼‰
        4. å®ç”¨è´´å£«ï¼ˆå®‰å…¨æç¤ºã€æ–‡åŒ–ç¤¼ä»ªã€å¤©æ°”å‡†å¤‡ã€è¡Œææ¸…å•ç­‰ï¼‰
        5. è¯­è¨€é£æ ¼ï¼šä¸“ä¸šã€å®ç”¨ã€ç®€æ´ï¼Œçªå‡ºé‡ç‚¹ä¿¡æ¯
        
        æ—…è¡Œè®¡åˆ’ï¼š
        """
    return prompt


# ç”Ÿæˆæ—…è¡Œè®¡åˆ’
def generate_travel_plan(destination, theme, days, season, budget, special_requests):
    """è°ƒç”¨å¤§æ¨¡å‹ç”Ÿæˆæ—…è¡Œè®¡åˆ’"""
    # ç”Ÿæˆæç¤ºè¯
    prompt = generate_prompt(destination, theme, days, season, budget, special_requests)
    print(prompt)
    try:
        response = client.chat.completions.create(
            model="qwen-plus-2025-04-28",
            messages=[
                {"role": "system", "content": "ä½ æ˜¯ä¸€ä½ä¸“ä¸šã€ç»†è‡´çš„æ—…è¡Œé¡¾é—®ï¼Œæ“…é•¿æ ¹æ®ç”¨æˆ·éœ€æ±‚ç”Ÿæˆè¯¦ç»†çš„æ—…è¡Œè®¡åˆ’ã€‚"},
                {"role": "user", "content": prompt}
            ],
            temperature=0.7,
            max_tokens=3000
        )
        return response.choices[0].message.content
    except Exception as e:
        st.error(f"ç”Ÿæˆæ—…è¡Œè®¡åˆ’æ—¶å‡ºé”™: {str(e)}")
        # å¦‚æœå‡ºé”™ï¼Œè¿”å›ä¸€ä¸ªç¤ºä¾‹æ—…è¡Œè®¡åˆ’
        return """
    # ç¤ºä¾‹æ—…è¡Œè®¡åˆ’

    ## ä¸€ã€è¡Œç¨‹å®‰æ’
    ### ç¬¬ä¸€å¤©ï¼šæŠµè¾¾ä¸é€‚åº”
    - **ä¸Šåˆ**ï¼šæŠµè¾¾ç›®çš„åœ°ï¼Œå‰å¾€é…’åº—åŠç†å…¥ä½ï¼Œç¨ä½œä¼‘æ¯
    - **äº¤é€š**ï¼šæœºåœºâ†’é…’åº—ï¼ˆå»ºè®®ä½¿ç”¨æœºåœºå¤§å·´æˆ–å‡ºç§Ÿè½¦ï¼‰
    - **é¤é¥®**ï¼šé…’åº—é™„è¿‘é¤å…ï¼Œå“å°å½“åœ°ç‰¹è‰²æ—©é¤
    - **ä¸‹åˆ**ï¼šå¸‚åŒºæ¼«æ­¥ï¼Œå‚è§‚é™„è¿‘æ™¯ç‚¹
    - **æ™šä¸Š**ï¼šåœ¨å¤œå¸‚å“å°ç¾é£Ÿï¼Œä½“éªŒå½“åœ°å¤œç”Ÿæ´»
    - **ä½å®¿**ï¼šç»æµå‹é…’åº—

    ### ç¬¬äºŒå¤©ï¼šæ¢ç´¢åŸå¸‚
    - **ä¸Šåˆ**ï¼šå‚è§‚ä¸»è¦æ™¯ç‚¹
    - **äº¤é€š**ï¼šåœ°é“/å…¬äº¤è½¦
    - **é¤é¥®**ï¼šæ™¯åŒºé™„è¿‘é¤å…
    - **ä¸‹åˆ**ï¼šç»§ç»­æ¸¸è§ˆæ™¯ç‚¹ï¼Œå‚åŠ æ–‡åŒ–æ´»åŠ¨
    - **æ™šä¸Š**ï¼šäº«ç”¨å½“åœ°ç¾é£Ÿï¼Œè§‚çœ‹ä¼ ç»Ÿè¡¨æ¼”
    - **ä½å®¿**ï¼šç»æµå‹é…’åº—

    ## äºŒã€é¢„ç®—ä¼°ç®—
    - æ¯æ—¥é¢„ç®—ï¼š300-800å…ƒ
    - æ€»é¢„ç®—ï¼šçº¦2000å…ƒï¼ˆ2å¤©ï¼‰
    - è´¹ç”¨åŒ…å«ï¼šä½å®¿ã€é¤é¥®ã€äº¤é€šã€é—¨ç¥¨ç­‰

    ## ä¸‰ã€å®ç”¨è´´å£«
    - å®‰å…¨æç¤ºï¼šä¿ç®¡å¥½ä¸ªäººè´¢ç‰©ï¼Œæ³¨æ„äº¤é€šå®‰å…¨
    - æ–‡åŒ–ç¤¼ä»ªï¼šå°Šé‡å½“åœ°ä¹ ä¿—ï¼Œç©¿ç€å¾—ä½“
    - è¡Œææ¸…å•ï¼šè½»ä¾¿è¡£ç‰©ã€èˆ’é€‚é‹å­ã€å¿…è¦è¯ä»¶

    å¸Œæœ›è¿™ä»½ç¤ºä¾‹è®¡åˆ’èƒ½ä¸ºæ‚¨æä¾›å‚è€ƒï¼
    """


# ä¸»åº”ç”¨
def main():
    st.title("ğŸŒ æ—…è¡Œè§„åˆ’åŠ©æ‰‹")
    st.markdown("æ ¹æ®æ‚¨çš„åå¥½ï¼Œç”Ÿæˆä¸ªæ€§åŒ–çš„æ—…è¡Œè®¡åˆ’")

    # ä¾§è¾¹æ  - ç”¨æˆ·è¾“å…¥
    with st.sidebar:
        st.header("æ—…è¡Œåå¥½")

        # ç›®çš„åœ°é€‰æ‹©
        region = st.selectbox("é€‰æ‹©åœ°åŒº", list(destinations.keys()))
        destination = st.selectbox("é€‰æ‹©å›½å®¶", destinations[region])

        # æ—…è¡Œä¸»é¢˜
        theme = st.selectbox("æ—…è¡Œä¸»é¢˜", list(travel_themes.keys()))

        # æ—…è¡Œå¤©æ•°
        days = st.slider("æ—…è¡Œå¤©æ•°", 1, 30, 7)

        # æ—…è¡Œå­£èŠ‚
        season = st.selectbox("æ—…è¡Œå­£èŠ‚", ["æ˜¥å­£ï¼ˆ3-5æœˆï¼‰", "å¤å­£ï¼ˆ6-8æœˆï¼‰", "ç§‹å­£ï¼ˆ9-11æœˆï¼‰", "å†¬å­£ï¼ˆ12-2æœˆï¼‰"])

        # é¢„ç®—æ°´å¹³
        budget = st.selectbox("é¢„ç®—æ°´å¹³", list(budget_levels.keys()))

        # ç‰¹æ®Šè¦æ±‚
        special_requests = st.text_area("ç‰¹æ®Šè¦æ±‚æˆ–åå¥½", placeholder="ä¾‹å¦‚ï¼šéœ€è¦æ— éšœç¢è®¾æ–½ã€å¯¹èŠ±ç²‰è¿‡æ•ç­‰")

        # ç”Ÿæˆæ—…è¡Œè®¡åˆ’æŒ‰é’®
        if st.button("ç”Ÿæˆæ—…è¡Œè®¡åˆ’"):
            # ç­‰å¾…åœ†åœˆ
            with st.spinner("æ­£åœ¨ç”Ÿæˆæ—…è¡Œè®¡åˆ’..."):
                # å¤§æ¨¡å‹ç”Ÿæˆçš„æ—…è¡Œè§„åˆ’
                travel_plan = generate_travel_plan(destination, theme, days, season, budget, special_requests)
                st.session_state.travel_plan = travel_plan
                st.success("æ—…è¡Œè®¡åˆ’ç”ŸæˆæˆåŠŸï¼")

    # æ˜¾ç¤ºæ—…è¡Œè®¡åˆ’
    if "travel_plan" in st.session_state:
        st.subheader("ğŸ“„ æ‚¨çš„ä¸ªæ€§åŒ–æ—…è¡Œè®¡åˆ’")
        st.markdown(st.session_state.travel_plan)

        # ä¸‹è½½æŒ‰é’®
        st.download_button(
            label="ğŸ“¥ ä¸‹è½½æ—…è¡Œè®¡åˆ’",
            data=st.session_state.travel_plan,
            file_name=f"{destination}_{days}æ—¥_{theme}ä¹‹æ—….txt",
            mime="text/plain"
        )

        # æ˜¾ç¤ºä¸€äº›æ—…è¡Œç»Ÿè®¡æ•°æ®
        st.subheader("ğŸ“Š æ—…è¡Œç»Ÿè®¡")
        col1, col2, col3 = st.columns(3)

        # é¢„ç®—å¯è§†åŒ–
        if budget == "é«˜ç«¯å¥¢å":
            daily_budget = int(budget_levels[budget]['æ¯æ—¥é¢„ç®—'].replace('å…ƒä»¥ä¸Š', ''))
        else:
            daily_budget = int(budget_levels[budget]['æ¯æ—¥é¢„ç®—'].split('-')[1].replace('å…ƒ', ''))
        total_budget = daily_budget * days

        col1.metric("æ€»é¢„ç®—", f"{total_budget}å…ƒ")
        col2.metric("æ¯æ—¥é¢„ç®—", budget_levels[budget]['æ¯æ—¥é¢„ç®—'])
        col3.metric("æ—…è¡Œå¤©æ•°", f"{days}å¤©")

        # é¢„ç®—åˆ†å¸ƒé¥¼å›¾
        fig, ax = plt.subplots(figsize=(8, 5))
        budget_data = {
            "ä½å®¿": total_budget * 0.4,
            "é¤é¥®": total_budget * 0.25,
            "äº¤é€š": total_budget * 0.2,
            "æ´»åŠ¨": total_budget * 0.15
        }
        ax.pie(
            budget_data.values(),
            labels=budget_data.keys(),
            autopct='%1.1f%%',
            startangle=90,
            colors=sns.color_palette('pastel')
        )
        ax.set_title("é¢„ç®—åˆ†å¸ƒ")
        st.pyplot(fig)
    else:
        # æ˜¾ç¤ºæ¬¢è¿ä¿¡æ¯å’Œçƒ­é—¨ç›®çš„åœ°
        st.markdown("""
        ### æ¬¢è¿ä½¿ç”¨æ—…è¡Œè§„åˆ’åŠ©æ‰‹
        è¯·åœ¨å·¦ä¾§é¢æ¿å¡«å†™æ‚¨çš„æ—…è¡Œåå¥½ï¼Œç„¶åç‚¹å‡»"ç”Ÿæˆæ—…è¡Œè®¡åˆ’"æŒ‰é’®ã€‚

        ### çƒ­é—¨ç›®çš„åœ°æ¨è
        """)

        # éšæœºæ˜¾ç¤ºå‡ ä¸ªçƒ­é—¨ç›®çš„åœ°
        popular_destinations = ["æ—¥æœ¬", "æ³°å›½", "æ³•å›½", "æ„å¤§åˆ©", "ç¾å›½"]
        for dest in popular_destinations:
            if dest in destination_details:
                st.markdown(f"""
                **{dest}**  
                - ç‰¹è‰²ï¼š{destination_details[dest]["ç‰¹è‰²"]}  
                - æœ€ä½³å­£èŠ‚ï¼š{destination_details[dest]["æœ€ä½³å­£èŠ‚"]}  
                - ç»å…¸æ™¯ç‚¹ï¼š{", ".join(destination_details[dest]["ç»å…¸æ™¯ç‚¹"][:3])}  
                """)


if __name__ == "__main__":
    main()
